<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live YouTube Names Magical Grimoire</title>
<style>
body {
  margin: 0;
  padding: 0;
  height: 100vh;
  width: 100vw;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #1c1208;
  font-family: 'Patrick Hand', cursive;
  overflow: hidden;
}

#book {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url('book.png') no-repeat center center;
  background-size: cover;
  overflow: hidden;
}

#page {
  position: relative;
  width: 90%;
  height: 90%;
  margin: auto;
  padding: 2%;
  color: #ff4d4d;
  font-size: clamp(60px, 7vw, 80px);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  overflow: hidden;
}

.line {
  width: 100%;
  text-align: center;
  margin-bottom: 1rem;
  position: relative;
}

.char {
  display: inline-block;
  position: relative;
  color: pink;
  text-shadow:
     0 0 2px #ff0000,
     0 0 4px #ff3333,
     0 0 6px #ff6666;
}

.spark {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: radial-gradient(circle, #ff0000, transparent);
  pointer-events: none;
  animation: float 0.8s linear forwards;
}

@keyframes float {
  0% {transform: translate(0,0) scale(1); opacity:1;}
  25% {transform: translate(5px,-5px) scale(1.1); opacity:0.8;}
  50% {transform: translate(-3px,-15px) scale(1.2); opacity:0.6;}
  75% {transform: translate(4px,-25px) scale(1); opacity:0.4;}
  100% {transform: translate(0px,-40px) scale(0.8); opacity:0;}
}

#quill {
  position: absolute;
  width: 150px;
  height: 150px;
  background: url('quill.png') no-repeat center center;
  background-size: contain;
  pointer-events: none;
  z-index: 10;
}
</style>
</head>
<body>

<div id="book">
  <div id="page"></div>
  <div id="quill"></div>
</div>

<script>
const page = document.getElementById('page');
const quill = document.getElementById('quill');

const API_KEY = 'AIzaSyAluUkOlp_pomwmJiBlygWanS7ak8qvoK4';
const LIVE_CHAT_ID = 'Cg0KC0dUQVJUSWYyS2Y0KicKGFVDa21ic0FfWkM3QXJKeUZzNi13OE9DdxILR1RBUlRJZjJLZjQ';
let nextPageToken = '';
const displayedMessages = new Set();

let currentPageCount = 0;
let namesOnCurrentPage = 0;

function createSpark(x, y) {
    const spark = document.createElement('div');
    spark.className = 'spark';
    spark.style.left = (x + (Math.random() * 8 - 4)) + 'px';
    spark.style.top = (y + (Math.random() * 8 - 4)) + 'px';
    page.appendChild(spark);
    setTimeout(() => spark.remove(), 800);
}

function moveQuill(charSpan) {
    const rect = charSpan.getBoundingClientRect();
    const pageRect = page.getBoundingClientRect();
    const quillWidth = 150;
    const quillHeight = 150;

    const x = rect.left - pageRect.left + charSpan.offsetWidth / 2 - quillWidth / 2;
    const y = rect.top - pageRect.top - quillHeight + 20;

    quill.style.left = x + 'px';
    quill.style.top = y + 'px';

    for (let i = 0; i < 3; i++) {
        createSpark(x + quillWidth / 2, y + quillHeight - 10);
    }
}

function writeName(name) {
    // Clear page after 8 names
    if (namesOnCurrentPage >= 8) {
        page.innerHTML = '';
        namesOnCurrentPage = 0;
        currentPageCount++;
    }

    const lineDiv = document.createElement('div');
    lineDiv.className = 'line';
    page.appendChild(lineDiv);

    namesOnCurrentPage++;

    let i = 0;
    function typeChar() {
        if (i < name.length) {
            const charSpan = document.createElement('span');
            charSpan.className = 'char';
            charSpan.textContent = name[i];
            lineDiv.appendChild(charSpan);
            moveQuill(charSpan);
            i++;
            setTimeout(typeChar, 150);
        }
    }
    typeChar();
}

async function fetchLiveComments() {
    try {
        const url = `https://youtube.googleapis.com/youtube/v3/liveChat/messages?liveChatId=${LIVE_CHAT_ID}&part=snippet,authorDetails&key=${API_KEY}${nextPageToken ? '&pageToken=' + nextPageToken : ''}`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.items) {
            data.items.forEach(item => {
                const name = item.authorDetails.displayName;
                if (!displayedMessages.has(item.id)) {
                    displayedMessages.add(item.id);
                    writeName(name);
                }
            });
        }

        nextPageToken = data.nextPageToken;
    } catch (err) {
        console.error('Error fetching live comments', err);
    } finally {
        setTimeout(fetchLiveComments, 3000);
    }
}

fetchLiveComments();
</script>

</body>
</html>
